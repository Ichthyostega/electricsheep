21d20
< #include <sys/stat.h>
509,536d507
< int
< electricsheep_vote(int vote) {
<     char ffn[5000];
<     FILE *ff;
<     char *hom = getenv("HOME");
<     struct stat sbuf;
<     if (!hom) {
< 	fprintf(real_stderr, "HOME envar not defined\n");
< 	return 1;
<     }
<     sprintf(ffn, "%s/.sheep/vote-fifo", hom);
< 
<     if (-1 == stat(ffn, &sbuf)) {
< 	fprintf(real_stderr, "vote failed stat %s\n", ffn);
< 	return 1;
<     }
< 
<     ff = fopen(ffn, "w");
<     if (NULL == ff) {
< 	fprintf(real_stderr, "vote failed fopen %s\n, ffn");
< 	return 1;
<     }
<     fprintf(ff, "%d\n", vote);
<     fclose(ff);
<     return 0;
< }
< 
< 
740,742c711,712
< 	    else {
< 	      /* If we're not demoing, then any activity causes deactivation,
< 		 except pressing up or down arrow.
---
> 	    else
> 	      /* If we're not demoing, then any activity causes deactivation.
744,759c714
< 		if ((event.xany.type == KeyRelease) || (event.xany.type == KeyPress)) {
< 		    switch (event.xkey.keycode) {
< 		    case 98:
< 			if ((event.xany.type == KeyPress) && electricsheep_vote(1))
< 			    goto DONE;
< 			break;
< 		    case 104:
< 			if ((event.xany.type == KeyPress) && electricsheep_vote(-1))
< 			    goto DONE;
< 			break;
< 		    default:
< 			goto DONE;
< 		    }
< 		} else
< 		    goto DONE;
< 	    }
---
> 	      goto DONE;
